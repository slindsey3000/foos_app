<%# SEO Meta Tags %>
<% content_for :title, "Find Foosball Clubs Near You | USA Foosball Association" %>
<% content_for :description, "Discover foosball clubs, tournaments, and players in your area. Join the United States Foosball Association for competitive play, leagues, and events across America." %>
<% content_for :keywords, "foosball clubs near me, foosball tournaments, table soccer, foosball leagues, competitive foosball, USA foosball, foosball players, foosball locations" %>

<%# Structured Data for Home Page %>
<% content_for :structured_data do %>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "USA Foosball Home",
  "description": "Find foosball clubs, tournaments, and players near you. Join the United States Foosball Association.",
  "url": "<%= request.original_url %>",
  "mainEntity": {
    "@type": "Organization",
    "name": "USA Foosball",
    "description": "The United States Foosball Association promotes competitive foosball across America"
  },
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "<%= request.base_url %>"
      }
    ]
  }
}
</script>
<% end %>

<div class="hero-section">
  <div class="container">
    <div class="hero-content">
      <h1>Welcome to USA Foosball</h1>
      <p>The United States Foosball Association - Promoting the sport across America</p>
      <div class="hero-buttons">
        <a href="/clubs" class="btn btn-primary">Find A Club</a>
        <% unless current_user %>
          <a href="/signup" class="btn btn-secondary mobile-only-btn">Become a Member</a>
        <% end %>
      </div>
    </div>
    <div class="hero-image">
      <%= image_tag "hero-foosball-dramatic.png", alt: "Dramatic foosball game with intense flames and stadium lighting" %>
    </div>
  </div>
</div>

<section class="news-section">
  <div class="container">
    <div class="section-header">
      <h2>Latest News</h2>
      <a href="/news" class="view-all-link">View All News</a>
    </div>
    <div class="news-grid">
      <% @news_articles&.first(3)&.each do |article| %>
        <article class="news-card">
          <div class="news-image">
            <% if article.image_url.present? %><%= image_tag article.image_url, alt: article.title %><% end %>
          </div>
          <div class="news-content">
            <h3><%= link_to article.title, article_path(article.slug) %></h3>
            <p class="news-excerpt"><%= truncate(strip_tags(article.content.to_s), length: 150) %></p>
            <div class="news-meta">
              <span class="news-date"><%= article.published_at.strftime("%B %d, %Y") %></span>
              <a href="<%= article_path(article.slug) %>" class="read-more">Read More</a>
            </div>
          </div>
        </article>
      <% end %>
    </div>
  </div>
</section>

<%# 
<section class="features-section">
  <div class="container">
    <h2>Why Choose USA Foosball?</h2>
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-icon">üèÜ</div>
        <h3>Official Tournaments</h3>
        <p>Compete in sanctioned tournaments across the country</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üë•</div>
        <h3>Community</h3>
        <p>Join a passionate community of foosball enthusiasts</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üìö</div>
        <h3>Learn & Improve</h3>
        <p>Access training resources and coaching programs</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üèÖ</div>
        <h3>Rankings & Ratings</h3>
        <p>Track your progress with our ranking system</p>
      </div>
    </div>
  </div>
</section>
%>

<section class="where-to-play-section">
  <div class="container">
    <div class="section-header">
      <h2>Where to Play</h2>
      <a href="/clubs" class="view-all-link">View All Clubs</a>
    </div>
    
    <div class="state-search">
      <%= form_with url: root_path, method: :get, local: true, class: "state-search-form" do |f| %>
        <div class="search-input-group">
                                  <%= f.text_field :state, placeholder: "Enter state name (e.g., California or CA)", 
                          class: "state-search-input", 
                          autocomplete: "off" %>
          <%= f.submit "Find Clubs", class: "btn btn-primary search-btn" %>
        </div>
        <div class="state-suggestions" id="state-suggestions"></div>
      <% end %>
    </div>
    <div class="locations-grid">
      <% @locations&.first(6)&.each do |club| %>
        <div class="location-card">
          <div class="location-image">
            <% if club.image_url.present? %>
              <%= image_tag club.image_url, alt: club.name %>
            <% else %>
              <div class="club-placeholder">
                <div class="placeholder-content">
                  <div class="placeholder-icon">üìç</div>
                </div>
              </div>
            <% end %>
          </div>
          <div class="location-content">
            <h3><%= link_to club.name, club_path(club) %></h3>
            <p class="location-address"><%= club.full_address %></p>
            <% if club.description.present? %>
              <p class="location-description"><%= truncate(club.description, length: 100) %></p>
            <% end %>
            <div class="location-meta">
              <span class="location-type">Club</span>
              <a href="<%= club_path(club) %>" class="location-link">View Details</a>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</section>

<section class="cta-section">
  <div class="container">
    <div class="cta-content">
      <h2>Ready to Get Started?</h2>
      <p>Join thousands of players across the United States</p>
      <div class="cta-buttons">
        <a href="/signup" class="btn btn-primary">Become a Member</a>
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const stateNames = <%= StateHelper::STATES.keys.sort.to_json.html_safe %>;
  
  const input = document.querySelector('.state-search-input');
  const suggestionsContainer = document.getElementById('state-suggestions');
  let currentFocus = -1;
  
  if (!input || !suggestionsContainer) return;
  
  function handleInputChange() {
    console.log('Input changed, value:', input.value); // Debug log
    const value = input.value.trim();
    closeSuggestions();
    currentFocus = -1;
    
    if (value.length < 1) {
      console.log('Value too short, returning'); // Debug log
      return;
    }
    
    const matches = stateNames.filter(state => 
      state.toLowerCase().startsWith(value.toLowerCase())
    ).slice(0, 8);
    
    console.log('Found matches:', matches); // Debug log
    
    if (matches.length > 0) {
      const dropdown = document.createElement('div');
      dropdown.className = 'suggestions-dropdown';
      
      matches.forEach((match, index) => {
        const item = document.createElement('div');
        item.className = 'suggestion-item';
        item.textContent = match;
        item.addEventListener('click', function() {
          input.value = match;
          closeSuggestions();
        });
        dropdown.appendChild(item);
      });
      
      suggestionsContainer.appendChild(dropdown);
    }
  }
  
  function setActive(suggestions) {
    suggestions.forEach((item, index) => {
      item.classList.toggle('highlighted', index === currentFocus);
    });
  }
  
  function closeSuggestions() {
    if (suggestionsContainer) {
      suggestionsContainer.innerHTML = '';
    }
    currentFocus = -1;
  }
  
  // Handle all input events
  input.addEventListener('input', handleInputChange);
  input.addEventListener('keyup', handleInputChange);
  input.addEventListener('paste', function() {
    setTimeout(handleInputChange, 10);
  });
  input.addEventListener('cut', function() {
    setTimeout(handleInputChange, 10);
  });
  
  input.addEventListener('keydown', function(e) {
    const suggestions = suggestionsContainer.querySelectorAll('.suggestion-item');
    
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      currentFocus++;
      if (currentFocus >= suggestions.length) currentFocus = 0;
      setActive(suggestions);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      currentFocus--;
      if (currentFocus < 0) currentFocus = suggestions.length - 1;
      setActive(suggestions);
    } else if (e.key === 'Enter') {
      if (currentFocus > -1 && suggestions[currentFocus]) {
        e.preventDefault();
        suggestions[currentFocus].click();
      }
    } else if (e.key === 'Escape') {
      closeSuggestions();
    }
  });
  
  // Close suggestions when clicking outside
  document.addEventListener('click', function(e) {
    if (!input.contains(e.target) && !suggestionsContainer.contains(e.target)) {
      closeSuggestions();
    }
  });
});
</script>
