<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <%# SEO Meta Tags %>
  <title><%= page_title %></title>
  <meta name="description" content="<%= page_description %>">
  <meta name="keywords" content="<%= page_keywords %>">
  <meta name="author" content="USA Foosball">
  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow">
  
  <%# Open Graph Meta Tags %>
  <meta property="og:title" content="<%= page_title %>">
  <meta property="og:description" content="<%= page_description %>">
  <meta property="og:type" content="website">
  <meta property="og:url" content="<%= request.original_url %>">
  <meta property="og:site_name" content="USA Foosball">
  <meta property="og:image" content="<%= asset_url('hero-foosball-dramatic.png') %>">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Dramatic foosball game with intense flames and stadium lighting">
  <meta property="og:image:type" content="image/png">
  
  <%# Twitter Card Meta Tags %>
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= page_title %>">
  <meta name="twitter:description" content="<%= page_description %>">
  <meta name="twitter:image" content="<%= asset_url('hero-foosball-dramatic.png') %>">
  <meta name="twitter:image:alt" content="Dramatic foosball game with intense flames and stadium lighting">
  <meta name="twitter:site" content="@usafoosball">
  <meta name="twitter:creator" content="@usafoosball">
  
  <%# Additional Social Media Meta Tags %>
  <meta property="article:publisher" content="https://www.facebook.com/usafoosball">
  <meta property="article:author" content="USA Foosball">
  <meta name="pinterest-rich-pin" content="true">
  
  <%# Additional SEO Meta Tags %>
  <meta name="theme-color" content="#dc2626">
  <meta name="msapplication-TileColor" content="#dc2626">
  <link rel="canonical" href="<%= request.original_url %>">
  
  <%# Structured Data %>
  <script type="application/ld+json">
    <%= structured_data_organization %>
  </script>
  
  <script type="application/ld+json">
    <%= structured_data_website %>
  </script>
  
  <%# Page-specific structured data %>
  <%= yield :structured_data %>
  
  <%# Rails helpers for including compiled assets %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "actiontext", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>

  <%# Link to Google Fonts for Poppins and Open Sans %>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
</head>
<body>

  <%# Render the site-wide header partial %>
  <%= render 'layouts/header' %>

  <main id="main-content">
    <%# Page-specific content will be yielded here %>
    <%= yield %>
  </main>

  <%# Render the site-wide footer partial %>
  <%= render 'layouts/footer' %>

  <%# Coming Soon Modal %>
  <div id="coming-soon-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Coming Very Soon!</h3>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>Website under development!</p>
        <p>We're working hard to bring you the best foosball experience.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="closeModal()">Got it!</button>
      </div>
    </div>
  </div>

  <%# Mobile Navigation JavaScript - Works across all pages %>
  <script>
    // Function to initialize mobile navigation
    function initMobileNav() {
      const hamburgerBtn = document.getElementById('hamburger-btn');
      const mobileMenu = document.getElementById('mobile-menu');
      
      if (hamburgerBtn && mobileMenu) {
        // Remove any existing event listeners to prevent duplicates
        const newHamburgerBtn = hamburgerBtn.cloneNode(true);
        hamburgerBtn.parentNode.replaceChild(newHamburgerBtn, hamburgerBtn);
        
        // Toggle menu on hamburger click
        newHamburgerBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          mobileMenu.classList.toggle('active');
        });
        
        // Close menu when clicking anywhere else
        document.addEventListener('click', function(e) {
          if (!mobileMenu.contains(e.target) && !newHamburgerBtn.contains(e.target)) {
            mobileMenu.classList.remove('active');
          }
        });
        
        // Close menu when clicking a link
        const menuLinks = mobileMenu.querySelectorAll('a');
        menuLinks.forEach(function(link) {
          link.addEventListener('click', function() {
            mobileMenu.classList.remove('active');
          });
        });
        
        // Prevent menu from closing when clicking inside it
        mobileMenu.addEventListener('click', function(e) {
          e.stopPropagation();
        });
        
        // Close menu on escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
            mobileMenu.classList.remove('active');
          }
        });
      }
    }
    
    // Initialize on DOM content loaded
    document.addEventListener('DOMContentLoaded', initMobileNav);
    
    // Initialize on Turbo navigation (for Rails Turbo)
    document.addEventListener('turbo:load', initMobileNav);
    document.addEventListener('turbo:render', initMobileNav);
    
    // Fallback for traditional navigation
    window.addEventListener('load', initMobileNav);
  </script>

  <%# Coming Soon Modal JavaScript %>
  <script>
    // Modal functions
    function showModal() {
      document.getElementById('coming-soon-modal').style.display = 'flex';
      document.body.style.overflow = 'hidden'; // Prevent background scrolling
    }
    
    function closeModal() {
      document.getElementById('coming-soon-modal').style.display = 'none';
      document.body.style.overflow = 'auto'; // Restore scrolling
    }
    
    // Initialize modal functionality
    function initModal() {
      // Find all "Become a Member" buttons and links
      const allLinks = document.querySelectorAll('a');
      
      allLinks.forEach(function(link) {
        // Check if it's a signup link or has "Become a Member" text
        if (link.getAttribute('href') === '/signup' || link.textContent.trim() === 'Become a Member') {
          // Remove existing event listeners
          const newLink = link.cloneNode(true);
          link.parentNode.replaceChild(newLink, link);
          
          // Add click event listener
          newLink.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            showModal();
          });
        }
      });
      
      // Close modal when clicking outside
      document.getElementById('coming-soon-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeModal();
        }
      });
      
      // Close modal on escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeModal();
        }
      });
    }
    
    // Initialize on DOM content loaded
    document.addEventListener('DOMContentLoaded', initModal);
    
    // Initialize on Turbo navigation (for Rails Turbo)
    document.addEventListener('turbo:load', initModal);
    document.addEventListener('turbo:render', initModal);
    
    // Fallback for traditional navigation
    window.addEventListener('load', initModal);
  </script>

</body>
</html>
